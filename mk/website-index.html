<!DOCTYPE html>
<meta charset="utf-8">
<title>Better NFD Status Page</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@2.0.3/build/pure-min.css" integrity="sha256-AYjWoduA0BJ4vwq+ISyw5uryLXRLvNwx2eKZ+/Ghs9o=" crossorigin="anonymous">
<link rel="stylesheet" href="style.css">

<h1>Better NFD Status Page</h1>

<h2>Download</h2>
<p>
  <a href="TARBALL" class="pure-button pure-button-primary">Download</a>
  <a href="https://github.com/yoursunny/NDNts-NFD-status-page" class="pure-button">Instructions</a>
</p>

<h2>Online Demo</h2>
<p>
  View a better NFD status page on one of these testbed routers.
  <br>
  <small>Please limit your session to 10 minutes, to conserve proxy resources. Thanks.</small>
</p>
<div id="demo">loading</div>

<script>
const PROXY = "https://nfd-status-page-demo-proxy.yoursunny.workers.dev";
(async () => {
  const [testbed, whitelist] = await Promise.all([
    "https://ndndemo.arl.wustl.edu/testbed-nodes.json",
    `${PROXY}/whitelist.json`,
  ].map((uri) => fetch(uri).then((r) => r.json())));
  const ul = document.createElement("ul");
  ul.style.lineHeight = "3ex";
  for (const { name, site, "fch-enabled": ok } of Object.values(testbed)) {
    const host = site.replace(/^http:\/\/|:80\/$/g, "");
    if (ok && whitelist.includes(host)) {
      const li = document.createElement("li");
      const a = document.createElement("a");
      a.textContent = name;
      a.href = `demo.html?uri=${encodeURIComponent(`${PROXY}/${host}.xml`)}`;
      li.append(a);
      ul.append(li);
    }
  }
  document.querySelector("#demo").replaceWith(ul);
})().catch((err) => {
  document.querySelector("#demo").textContent = err;
});
</script>
